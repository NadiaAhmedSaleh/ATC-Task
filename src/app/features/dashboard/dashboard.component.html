<div class="p-6 max-w-6xl mx-auto mb-4">
  <nav
    class="fixed top-0 left-0 w-full bg-white/30 backdrop-blur-md border-b border-white/20 shadow-sm px-4 py-2 flex flex-wrap justify-between items-center z-50 gap-2"
  >
    <div class="flex gap-2 flex-wrap">
      <button
        class="px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition"
        (click)="createProduct()"
      >
        Create Product
      </button>
    </div>

    <div class="flex gap-2 flex-wrap">
      <button
        class="px-3 py-2 rounded-lg bg-red-100 border border-red-500 text-red-600 hover:bg-red-500 hover:text-white transition"
        (click)="logout()"
      >
        Logout
      </button>
    </div>
  </nav>
</div>

<div class="p-6 max-w-6xl mx-auto mt-10">
  
  <div class="flex flex-wrap justify-center gap-2 mb-6">
    <div class="relative flex-1 min-w-[200px]">
      <input
        type="text"
        placeholder="Search products..."
        class="w-full pl-10 pr-4 py-2.5 rounded-lg bg-white border border-gray-300 focus:ring-2 focus:ring-blue-300 focus:outline-none text-gray-700"
        [(ngModel)]="search"
        (input)="onSearchInput()"
        (ngModelChange)="search === '' && fetchProducts()"
      />
      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-4.35-4.35M16 10a6 6 0 11-12 0 6 6 0 0112 0z"
          />
        </svg>
      </span>
    </div>

    <select
      [(ngModel)]="is_active"
      (change)="onFilterChange()"
      class="px-3 py-2 rounded-lg border border-gray-300 bg-white focus:ring-2 focus:ring-blue-300 focus:outline-none min-w-[100px]"
    >
      <option [ngValue]="null">All</option>
      <option [ngValue]="true">Active</option>
      <option [ngValue]="false">Inactive</option>
    </select>

    <select
      [(ngModel)]="per_page"
      (change)="onPerPageChange()"
      class="px-3 py-2 rounded-lg border border-gray-300 bg-white focus:ring-2 focus:ring-blue-300 focus:outline-none min-w-[100px]"
    >
      <option *ngFor="let opt of perPageOptions" [value]="opt">
        {{ opt }} per page
      </option>
    </select>
  </div>

  <div
    class="overflow-x-auto bg-gray-50 border border-white/40 shadow-xl rounded-2xl p-4">
    
     <app-spinner [show]="loading"></app-spinner>
    <div *ngIf="error" class="error text-center py-4">{{ error }}</div>
    <div *ngIf="!loading && !products.length" class="text-center py-4">
      No results.
    </div>

    <table
      class="min-w-full text-left border-collapse"
      *ngIf="!loading && products.length"
    >
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-4 py-2 text-gray-600 font-medium">ID</th>
          <th class="px-4 py-2 text-gray-600 font-medium">Name</th>
          <th class="px-4 py-2 text-gray-600 font-medium">SKU</th>
          <th class="px-4 py-2 text-gray-600 font-medium">Slug</th>
          <th class="px-4 py-2 text-gray-600 font-medium">Price</th>
          <th class="px-4 py-2 text-gray-600 font-medium">Status</th>
          <th class="px-4 py-2 text-gray-600 font-medium">Action</th>

        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100">
        <tr
          class="hover:bg-gray-200 transition"
          *ngFor="let p of products"
          (click)="showDetails(p.id)"
        >
          <td class="px-4 py-2 text-gray-700">{{ p.id }}</td>
          <td class="px-4 py-2 text-gray-700">{{ p.name }}</td>
          <td class="px-4 py-2 text-gray-700">{{ p.sku }}</td>
          <td class="px-4 py-2 text-gray-700">{{ p.slug }}</td>
          <td class="px-4 py-2 text-gray-700">${{ p.price ?? "-" }}</td>
          <td class="px-4 py-2">
            <span
              class="px-2 py-1 text-sm rounded"
              [ngClass]="
                p.is_active
                  ? 'bg-green-100 text-green-700'
                  : 'bg-red-100 text-red-700'
              "
            >
              {{ p.is_active ? "Active" : "Inactive" }}
            </span>
          </td>
          <td class="flex flex-wrap gap-2 justify-center mt-1.5">
  <button
    (click)="openDeletePopup(p.id); $event.stopPropagation()"
    class="px-2 py-1  text-xs bg-red-100 text-red-700 rounded
           hover:bg-red-500 hover:text-white transition
           sm:px-3 sm:py-1 sm:text-xs"
  >
    Delete
  </button>

  <button
    (click)="updateProduct(p.id) ; $event.stopPropagation()"
    class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded
           hover:bg-green-500 hover:text-white transition
           sm:px-3 sm:py-1 sm:text-xs"
  >
    Edit
  </button>
</td>


        </tr>
      </tbody>
    </table>

    
  </div>

  <div
    *ngIf="total_pages > 1"
    class="flex flex-wrap justify-between items-center gap-2 mt-4 bg-gray-50 p-2 rounded-lg shadow-lg border border-gray-200 w-full max-w-md mx-auto"
  >
    <button
      (click)="prev()"
      [disabled]="page === 1"
      class="px-3 py-1 rounded-lg text-sm font-medium border border-gray-300 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-gray-100 transition"
    >
      Prev
    </button>

    <div class="text-sm text-gray-600 flex items-center gap-2">
      <span class="font-medium text-gray-800">Page {{ page }}</span>
      <span>of {{ total_pages }}</span>
    </div>

    <button
      (click)="next()"
      [disabled]="page >= total_pages"
      class="px-3 py-1 rounded-lg text-sm font-medium border border-gray-300 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-gray-100 transition"
    >
      Next
    </button>
  </div>

</div>

<div 
  *ngIf="showDeletePopup" 
  class="fixed inset-0 bg-opacity-40 backdrop-blur-sm  flex items-center justify-center z-50"
>
  <div class="bg-white p-4 rounded-lg shadow-md w-72">
    <h2 class="text-lg font-semibold mb-3">Confirm Delete</h2>
    <p class="text-sm text-gray-600 mb-4">Are you sure you want to delete this product?</p>

    <div class="flex justify-end gap-2">
      <button 
        (click)="cancelDelete()" 
        class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-200"
      >
        Cancel
      </button>

      <button 
        (click)="confirmDelete()" 
        class="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600"
      >
        Delete
      </button>
    </div>
  </div>
</div>

